<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="deposithistory">
  
  <select id="achistory" parameterType="hashMap" resultType="achvo">
  select r_num,dealdate,dep_money,wit_money,balance,name
	from(
	select rownum r_num
	, COALESCE(to_char(d.dep_date,'YY-MM-DD HH24:MI'),to_char(w.wit_date,'YY-MM-DD HH24:MI')) dealdate
	, nvl(to_char(d.dep_money),'-') dep_money
	, nvl(to_char(w.wit_money),'-') wit_money
	, sp.sp_balance balance
	, sp.sp_name name
	from account a
	, sav_process sp
	, deposit d
	, withdraw w
	where 
	a.mem_code=#{mem_code} 
	and a.ac_code=(select ac_code 
					from account 
					where ac_num=#{ac_num} 
					and mem_code=#{mem_code})
	and sp.ac_code=(select ac_code 
					from account 
					where ac_num=#{ac_num} 
					and mem_code=#{mem_code})
	 and d.dep_code(+) = sp.dep_code 
	 and w.wit_code(+) = sp.wit_code
	order by 1 )
	where r_num between #{start} and #{end}
	
  </select>
  
  <select id="totalcnt" resultType="int" parameterType="hashMap">
  select count(*)
   from sav_process
    where ac_code =(select ac_code
    				 from account
    				  where ac_num=#{ac_num} and mem_code=#{mem_code})
  </select>
  </mapper>