<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="depositsy">
  
  	<select id="checkac" parameterType="int" resultType="int">
		select count(*)
		from account
		where ac_num=#{ac_num}
  	</select>
  	
  	
  	
  	
  	<insert id="plusdep" parameterType="int">
<!--   	DEP_CODE  NOT NULL NUMBER  -->
<!-- DEP_MONEY NOT NULL NUMBER  -->
<!-- DEP_DATE  NOT NULL DATE   -->
  		insert into deposit values(deposit_seq.nextval,#{dep_money},sysdate)
  	</insert>
  	
  	
  	
  	
  	
  	
  
  	<insert id="plussp" parameterType="hashMap">
  	
<!--   	SP_CODE  NOT NULL NUMBER        -->
<!-- AC_CODE  NOT NULL NUMBER        -->
<!-- SP_NAME           VARCHAR2(30)  -->
<!-- DEP_CODE          NUMBER        -->
<!-- WIT_CODE          NUMBER        -->
<!-- AT_CODE           NUMBER     -->
  	
insert into sav_process values(sav_process_seq.nextval
	,(select ac_code
	from account
	where ac_num=#{ac_num} and mem_code=#{mem_code})
	,#{sp_name}
	,(select max(dep_code)
	            from deposit)
	,null
	,null
	,(select ac_balance from account where ac_num=#{ac_num})+(select dep_money 
	                                                                from deposit 
	                                                                where dep_code=(select max(dep_code) 
	                                                                                   from deposit))
)
  	</insert>
  	
  	
  	<update id="depupbalance" parameterType="hashMap">
  
	update account 
		set ac_balance=(select sp_balance 
		                from sav_process 
		                where sp_code=(select max(sp_code) 
		                                from sav_process))
		where ac_code=
		    (select ac_code
		    from account
		    where ac_num=#{ac_num} and mem_code=#{mem_code})
  	</update>
  </mapper>